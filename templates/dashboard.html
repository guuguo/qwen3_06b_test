<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ai-primary': '#667eea',
                        'ai-primary-light': '#8fa4f3',
                        'ai-primary-dark': '#4c63d2',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shimmer': 'shimmer 1.5s infinite',
                    },
                    keyframes: {
                        shimmer: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(100%)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* è‡ªå®šä¹‰åŠ¨ç”» */
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* ä¿ç•™å¿…è¦çš„è‡ªå®šä¹‰æ ·å¼ */
        .header {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        /* çº§è”æ ·å¼ä¿ç•™ */
        .status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #6366f1, #8b5cf6);
            border-radius: 0 2px 2px 0;
        }
        
        /* éšè—responseAreaçš„CSSç±» */
        .hidden { display: none !important; }
        
        
        
        
        /* ä¿ç•™çš„å¿…è¦CSSæ ·å¼ */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ä¿ç•™å¿…è¦çš„çŠ¶æ€æ ·å¼ */
        .status-correct {
            color: #10b981;
            font-weight: 600;
        }
        
        .status-incorrect {
            color: #ef4444;
            font-weight: 600;
        }
        
        .status-partial {
            color: #f59e0b;
            font-weight: 600;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
        }
        
        .modal.show {
            display: flex;
        }
        
        .clickable-sample {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .clickable-sample:hover {
            background-color: #e3f2fd !important;
            transform: scale(1.01);
        }
        
    </style>
</head>
<body class="bg-slate-50 font-sans antialiased">
    <div class="header bg-white border-b border-slate-200 py-4 sticky top-0 z-50 transition-all duration-300">
        <div class="max-w-6xl mx-auto px-8 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm">Q3</div>
                <div>
                    <h1 class="text-xl font-semibold text-slate-900 m-0">{{ title }}</h1>
                    <div class="text-xs text-slate-500 font-normal mt-0.5">AIæ¨¡å‹ç›‘æ§ä¸æµ‹è¯•å¹³å°</div>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2 px-3 py-2 bg-slate-50 rounded-full text-xs font-medium text-slate-600">
                    <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                    <span>ç³»ç»Ÿè¿è¡Œä¸­</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="max-w-6xl mx-auto px-8 py-6">
        <div class="flex flex-col gap-8">
            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="bg-white rounded-xl p-8 shadow-sm border border-slate-200 transition-all duration-300">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-2 text-lg font-semibold text-slate-800">
                        <div class="w-5 h-5 flex items-center justify-center text-sm">ğŸ“Š</div>
                        ç³»ç»ŸçŠ¶æ€
                    </div>
                </div>
                <div class="grid grid-cols-4 gap-6" id="statusGrid">
                    <div class="text-center py-8 text-slate-500">æ­£åœ¨åŠ è½½ç³»ç»ŸçŠ¶æ€...</div>
                </div>
            </div>
            
            <!-- å›¾è¡¨åŒºåŸŸ -->
            <div class="bg-white rounded-xl p-8 shadow-sm border border-slate-200 transition-all duration-300">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-2 text-lg font-semibold text-slate-800">
                        <div class="w-5 h-5 flex items-center justify-center text-sm">ğŸ“ˆ</div>
                        æ€§èƒ½ç›‘æ§
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-6" id="chartsGrid">
                    <div class="text-center py-8 text-slate-500">æ­£åœ¨åŠ è½½å›¾è¡¨æ•°æ®...</div>
                </div>
            </div>
        
            <!-- æµ‹è¯•å·¥å…· -->
            <div class="bg-white rounded-xl p-8 shadow-sm border border-slate-200 transition-all duration-300">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-2 text-lg font-semibold text-slate-800">
                        <div class="w-5 h-5 flex items-center justify-center text-sm">ğŸ§ª</div>
                        æ¨ç†æµ‹è¯•
                    </div>
                </div>
                <div class="flex flex-col gap-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div class="flex flex-col gap-2">
                            <label for="modelSelect" class="text-sm font-medium text-slate-600 uppercase tracking-wide">æ¨¡å‹é€‰æ‹©</label>
                            <select id="modelSelect" class="px-4 py-3 border border-slate-300 rounded-lg text-sm transition-all duration-150 bg-white text-slate-900 focus:outline-none focus:border-indigo-500 focus:ring-3 focus:ring-indigo-500/10">
                                <option value="qwen3:0.6b">Qwen3 0.6B</option>
                                <option value="qwen3:1.7b">Qwen3 1.7B</option>
                            </select>
                        </div>
                
                        <div class="flex flex-col gap-2">
                            <label for="promptInput" class="text-sm font-medium text-slate-600 uppercase tracking-wide">æµ‹è¯•å†…å®¹</label>
                            <textarea id="promptInput" rows="4" class="px-4 py-3 border border-slate-300 rounded-lg text-sm transition-all duration-150 bg-white text-slate-900 placeholder-slate-500 resize-none focus:outline-none focus:border-indigo-500 focus:ring-3 focus:ring-indigo-500/10" placeholder="è¯·è¾“å…¥è¦æµ‹è¯•çš„æ–‡æœ¬å†…å®¹â€¦">è¿™ä¸ªäº§å“çœŸçš„å¾ˆæ£’ï¼</textarea>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 justify-start">
                        <button class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium text-sm text-white bg-gradient-to-r from-indigo-500 to-purple-600 shadow-sm transition-all duration-150 hover:-translate-y-0.5 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none" onclick="runTest()" id="testBtn">
                            <span>ğŸš€</span>
                            è¿è¡Œæµ‹è¯•
                        </button>
                        <button class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium text-sm text-slate-700 bg-white border border-slate-300 shadow-sm transition-all duration-150 hover:bg-slate-50 hover:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed" onclick="clearResults()">
                            <span>ğŸ—‘ï¸</span>
                            æ¸…ç©ºç»“æœ
                        </button>
                    </div>
                    
                    <div id="responseArea" class="mt-4 p-4 bg-slate-50 border border-slate-200 rounded-lg hidden whitespace-pre-wrap font-mono text-sm"></div>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•é›†ç®¡ç† -->
        <div class="bg-white rounded-xl p-8 shadow-sm border border-slate-200 transition-all duration-300">
            <h2 class="text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2">
                <span>ğŸ“‹</span> æµ‹è¯•é›†è¯„ä¼°
            </h2>
            
            <!-- æµ‹è¯•é›†é€‰æ‹© -->
            <div class="flex flex-col gap-6">
                <div class="flex flex-col gap-2">
                    <label for="datasetSelect" class="text-sm font-medium text-slate-600 uppercase tracking-wide">é€‰æ‹©æµ‹è¯•é›†:</label>
                    <select id="datasetSelect" onchange="loadDatasetInfo()" class="px-4 py-3 border border-slate-300 rounded-lg text-sm transition-all duration-150 bg-white text-slate-900 focus:outline-none focus:border-indigo-500 focus:ring-3 focus:ring-indigo-500/10">
                        <option value="">æ­£åœ¨åŠ è½½æµ‹è¯•é›†...</option>
                    </select>
                </div>
                
                <div id="datasetInfo" class="hidden">
                    <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                        <h4 id="datasetTitle" class="text-indigo-600 mb-2 font-semibold">æµ‹è¯•é›†ä¿¡æ¯</h4>
                        <p id="datasetDescription" class="text-slate-700 mb-3">æè¿°ä¿¡æ¯</p>
                        <div class="flex gap-4 flex-wrap">
                            <span class="bg-white px-3 py-1 rounded border border-slate-200 text-sm">
                                ğŸ“Š æ€»æ ·æœ¬: <strong id="datasetSamples" class="text-indigo-600">0</strong>
                            </span>
                            <span class="bg-white px-3 py-1 rounded border border-slate-200 text-sm">
                                ğŸ·ï¸ ç±»åˆ«: <strong id="datasetCategories" class="text-indigo-600">0</strong>
                            </span>
                            <span class="bg-white px-3 py-1 rounded border border-slate-200 text-sm">
                                ğŸ“Œ ç‰ˆæœ¬: <strong id="datasetVersion" class="text-indigo-600">1.0.0</strong>
                            </span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-6">
                    <div class="flex flex-col gap-2">
                        <label for="testModelSelect" class="text-sm font-medium text-slate-600 uppercase tracking-wide">æµ‹è¯•æ¨¡å‹:</label>
                        <select id="testModelSelect" class="px-4 py-3 border border-slate-300 rounded-lg text-sm transition-all duration-150 bg-white text-slate-900 focus:outline-none focus:border-indigo-500 focus:ring-3 focus:ring-indigo-500/10"> 
                            <option value="qwen3:0.6b">qwen3:0.6b</option>
                            <option value="qwen3:1.7b">qwen3:1.7b</option>
                        </select>
                    </div>
                    
                    <div class="flex flex-col gap-2">
                        <label for="sampleCountInput" class="text-sm font-medium text-slate-600 uppercase tracking-wide">æ ·æœ¬æ•°é‡:</label>
                        <input type="number" id="sampleCountInput" min="1" max="50" value="10" placeholder="æµ‹è¯•æ ·æœ¬æ•°é‡" class="px-4 py-3 border border-slate-300 rounded-lg text-sm transition-all duration-150 bg-white text-slate-900 placeholder-slate-500 focus:outline-none focus:border-indigo-500 focus:ring-3 focus:ring-indigo-500/10">
                    </div>
                </div>
                
                <div class="flex gap-4 flex-wrap">
                    <button class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium text-sm text-white bg-gradient-to-r from-indigo-500 to-purple-600 shadow-sm transition-all duration-150 hover:-translate-y-0.5 hover:shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none" id="runDatasetBtn" onclick="runDatasetTest()">
                        ğŸš€ è¿è¡Œæµ‹è¯•é›†è¯„ä¼°
                    </button>
                    <button class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium text-sm text-slate-700 bg-white border border-slate-300 shadow-sm transition-all duration-150 hover:bg-slate-50 hover:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed" id="runAllDatasetsBtn" onclick="runAllDatasetsTest()">
                        ğŸ“Š è¿è¡Œæ‰€æœ‰æµ‹è¯•é›†
                    </button>
                    <button class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium text-sm text-indigo-600 bg-transparent border border-indigo-500 shadow-sm transition-all duration-150 hover:bg-indigo-500 hover:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed" id="previewSamplesBtn" onclick="previewSamples()">
                        ğŸ‘€ é¢„è§ˆæ ·æœ¬
                    </button>
                </div>
                
                <div id="datasetTestProgress" class="mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200 hidden">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-indigo-600 font-semibold m-0">æµ‹è¯•è¿›åº¦</h4>
                        <div class="text-sm text-slate-600" id="progressStatus">å‡†å¤‡ä¸­...</div>
                    </div>
                    <div class="w-full h-2 bg-slate-200 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-indigo-500 to-purple-600 w-0 transition-all duration-300 ease-out" id="progressFill"></div>
                    </div>
                </div>
                
                <div id="datasetTestResults" class="mt-4 p-4 bg-white rounded-lg border border-slate-200 hidden"></div>
                
                <div id="samplesPreview" class="mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200 hidden">
                    <h4 class="text-lg font-semibold text-slate-800 mb-4">æ ·æœ¬é¢„è§ˆ</h4>
                    <div id="samplesContainer"></div>
                </div>
            </div>
        </div>
        
        <!-- æœ€è¿‘è¯·æ±‚æ—¥å¿— -->
        <div class="bg-white rounded-xl p-8 shadow-sm border border-slate-200 transition-all duration-300">
            <h2 class="text-lg font-semibold text-slate-800 mb-6">æœ€è¿‘è¯·æ±‚</h2>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse" id="logsTable">
                    <thead>
                        <tr class="border-b border-slate-200">
                            <th class="px-3 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wide bg-slate-50">æ—¶é—´</th>
                            <th class="px-3 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wide bg-slate-50">æ¨¡å‹</th>
                            <th class="px-3 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wide bg-slate-50">çŠ¶æ€</th>
                            <th class="px-3 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wide bg-slate-50">å»¶è¿Ÿ(ms)</th>
                            <th class="px-3 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wide bg-slate-50">æç¤ºé•¿åº¦</th>
                            <th class="px-3 py-4 text-left text-xs font-medium text-slate-500 uppercase tracking-wide bg-slate-50">å“åº”é•¿åº¦</th>
                        </tr>
                    </thead>
                    <tbody id="logsTableBody" class="divide-y divide-slate-200">
                        <tr>
                            <td colspan="6" class="text-center py-8 text-slate-500">æ­£åœ¨åŠ è½½æ—¥å¿—æ•°æ®...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let refreshInterval = 5000; // 5ç§’åˆ·æ–°é—´éš”ï¼Œæ¡Œé¢ç«¯å›ºå®šé…ç½®
        let refreshTimer;
        
        // å…¨å±€çŠ¶æ€
        let currentDatasets = [];
        let currentDataset = null;
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
            loadMetrics();
            loadDatasets();
            startAutoRefresh();
        });
        
        // åŠ è½½ç³»ç»ŸçŠ¶æ€
        async function loadSystemStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                if (response.ok) {
                    renderSystemStatus(data);
                } else {
                    showError('åŠ è½½ç³»ç»ŸçŠ¶æ€å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('åŠ è½½ç³»ç»ŸçŠ¶æ€å¤±è´¥: ' + error.message);
            }
        }
        
        // æ¸²æŸ“ç³»ç»ŸçŠ¶æ€
        function renderSystemStatus(data) {
            const statusGrid = document.getElementById('statusGrid');
            
            const ollamaStatus = data.ollama.status === 'online' ? 'online' : 'offline';
            const ollamaIndicator = `<span class="status-indicator status-${ollamaStatus}"></span>`;
            
            const systemMetrics = data.system || {};
            
            statusGrid.innerHTML = `
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-200 min-h-[140px] flex flex-col justify-between transition-all duration-300 relative overflow-hidden hover:-translate-y-0.5 hover:shadow-lg hover:border-indigo-500 group status-card">
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-sm font-medium text-slate-600 uppercase tracking-wide">Ollama æœåŠ¡</h3>
                            <div class="w-2 h-2 ${data.ollama.status === 'online' ? 'bg-emerald-500' : 'bg-red-500'} rounded-full animate-pulse"></div>
                        </div>
                        <div class="text-3xl font-bold text-slate-900 mb-1 bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent">${data.ollama.status === 'online' ? 'åœ¨çº¿' : 'ç¦»çº¿'}</div>
                        <div class="text-sm text-slate-500">URL: ${data.ollama.url}</div>
                        <div class="text-sm text-slate-500">æ¨¡å‹æ•°é‡: ${data.ollama.models.length}</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-200 min-h-[140px] flex flex-col justify-between transition-all duration-300 relative overflow-hidden hover:-translate-y-0.5 hover:shadow-lg hover:border-indigo-500 group status-card">
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-sm font-medium text-slate-600 uppercase tracking-wide">CPU ä½¿ç”¨ç‡</h3>
                        </div>
                        <div class="text-3xl font-bold text-slate-900 mb-1 bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent">${(systemMetrics.cpu_percent || 0).toFixed(1)}%</div>
                        <div class="text-xs text-slate-500 uppercase tracking-wide">å¤„ç†å™¨ä½¿ç”¨ç‡</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-200 min-h-[140px] flex flex-col justify-between transition-all duration-300 relative overflow-hidden hover:-translate-y-0.5 hover:shadow-lg hover:border-indigo-500 group status-card">
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-sm font-medium text-slate-600 uppercase tracking-wide">å†…å­˜ä½¿ç”¨</h3>
                        </div>
                        <div class="text-3xl font-bold text-slate-900 mb-1 bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent">${(systemMetrics.memory_percent || 0).toFixed(1)}%</div>
                        <div class="text-xs text-slate-500 uppercase tracking-wide">${(systemMetrics.memory_used_gb || 0).toFixed(2)} GB å·²ä½¿ç”¨</div>
                        <div class="text-xs text-slate-400">æ€»è®¡: ${(systemMetrics.memory_total_gb || 0).toFixed(2)} GB</div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-200 min-h-[140px] flex flex-col justify-between transition-all duration-300 relative overflow-hidden hover:-translate-y-0.5 hover:shadow-lg hover:border-indigo-500 group status-card">
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-sm font-medium text-slate-600 uppercase tracking-wide">ç£ç›˜ä½¿ç”¨</h3>
                        </div>
                        <div class="text-3xl font-bold text-slate-900 mb-1 bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent">${(systemMetrics.disk_usage_percent || 0).toFixed(1)}%</div>
                        <div class="text-xs text-slate-500 uppercase tracking-wide">${(systemMetrics.disk_used_gb || 0).toFixed(2)} GB å·²ä½¿ç”¨</div>
                        <div class="text-xs text-slate-400">æ€»è®¡: ${(systemMetrics.disk_total_gb || 0).toFixed(2)} GB</div>
                    </div>
                </div>
            `;
        }
        
        // åŠ è½½æŒ‡æ ‡æ•°æ®
        async function loadMetrics() {
            try {
                const response = await fetch('/api/metrics?hours=1');
                const data = await response.json();
                
                if (response.ok) {
                    renderCharts(data.charts);
                    renderRecentRequests(data.recent_requests);
                } else {
                    showError('åŠ è½½æŒ‡æ ‡æ•°æ®å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('åŠ è½½æŒ‡æ ‡æ•°æ®å¤±è´¥: ' + error.message);
            }
        }
        
        // æ¸²æŸ“å›¾è¡¨
        function renderCharts(charts) {
            const chartsGrid = document.getElementById('chartsGrid');
            
            if (!charts || Object.keys(charts).length === 0) {
                chartsGrid.innerHTML = '<div class="text-center py-8 text-slate-500">æš‚æ— å›¾è¡¨æ•°æ®</div>';
                return;
            }
            
            chartsGrid.innerHTML = '';
            
            Object.entries(charts).forEach(([chartId, chartConfig]) => {
                const chartContainer = document.createElement('div');
                chartContainer.className = 'bg-white rounded-xl shadow-sm border border-slate-200 p-4 overflow-hidden transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg';
                chartContainer.id = chartId;
                chartsGrid.appendChild(chartContainer);
                
                // æ¡Œé¢ç«¯å›ºå®šå°ºå¯¸é…ç½®
                Plotly.newPlot(chartId, chartConfig.data, chartConfig.layout, {
                    displayModeBar: false,
                    staticPlot: false
                });
            });
        }
        
        // æ¸²æŸ“æœ€è¿‘è¯·æ±‚
        function renderRecentRequests(requests) {
            const tableBody = document.getElementById('logsTableBody');
            
            if (!requests || requests.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-slate-500">æš‚æ— è¯·æ±‚æ•°æ®</td></tr>';
                return;
            }
            
            tableBody.innerHTML = requests.map(req => `
                <tr class="hover:bg-slate-50">
                    <td class="px-3 py-4 text-slate-900">${new Date(req.timestamp).toLocaleString()}</td>
                    <td class="px-3 py-4 text-slate-900">${req.model}</td>
                    <td class="px-3 py-4">
                        <div class="inline-flex items-center gap-2">
                            <div class="w-2 h-2 ${req.status === 'success' ? 'bg-emerald-500' : 'bg-red-500'} rounded-full"></div>
                            <span class="text-sm font-medium ${req.status === 'success' ? 'text-emerald-700' : 'text-red-700'}">${req.status}</span>
                        </div>
                    </td>
                    <td class="px-3 py-4 text-slate-900">${req.latency_ms.toFixed(1)}</td>
                    <td class="px-3 py-4 text-slate-900">${req.prompt_length}</td>
                    <td class="px-3 py-4 text-slate-900">${req.response_length}</td>
                </tr>
            `).join('');
        }
        
        // è¿è¡Œæµ‹è¯•
        async function runTest() {
            const testBtn = document.getElementById('testBtn');
            const responseArea = document.getElementById('responseArea');
            const modelSelect = document.getElementById('modelSelect');
            const promptInput = document.getElementById('promptInput');
            
            const model = modelSelect.value;
            const prompt = promptInput.value.trim();
            
            if (!prompt) {
                showError('è¯·è¾“å…¥æµ‹è¯•æç¤ºè¯');
                return;
            }
            
            testBtn.disabled = true;
            testBtn.textContent = 'æµ‹è¯•ä¸­...';
            responseArea.classList.remove('hidden');
            responseArea.textContent = 'æ­£åœ¨å¤„ç†è¯·æ±‚...';
            
            try {
                const response = await fetch('/api/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: model,
                        prompt: prompt
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    responseArea.innerHTML = `
                        <strong>å“åº”:</strong>
                        ${data.response}
                        
                        <strong>æŒ‡æ ‡:</strong>
                        å»¶è¿Ÿ: ${data.metrics.latency_ms.toFixed(1)}ms
                        é€Ÿåº¦: ${(data.metrics.tokens_per_second || 0).toFixed(1)} tokens/s
                        æç¤ºtokens: ${data.metrics.prompt_tokens || 0}
                        å“åº”tokens: ${data.metrics.response_tokens || 0}
                    `;
                    
                    // åˆ·æ–°æ•°æ®
                    setTimeout(() => {
                        loadMetrics();
                    }, 1000);
                } else {
                    responseArea.textContent = 'é”™è¯¯: ' + (data.error || 'æµ‹è¯•å¤±è´¥');
                }
            } catch (error) {
                responseArea.textContent = 'é”™è¯¯: ' + error.message;
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'è¿è¡Œæµ‹è¯•';
            }
        }
        
        // å¼€å§‹è‡ªåŠ¨åˆ·æ–°
        function startAutoRefresh() {
            refreshTimer = setInterval(() => {
                loadSystemStatus();
                loadMetrics();
            }, refreshInterval);
        }
        
        // åœæ­¢è‡ªåŠ¨åˆ·æ–°
        function stopAutoRefresh() {
            if (refreshTimer) {
                clearInterval(refreshTimer);
                refreshTimer = null;
            }
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            console.error(message);
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¥½çš„é”™è¯¯æ˜¾ç¤ºé€»è¾‘
        }
        
        // æ¸…ç©ºæµ‹è¯•ç»“æœ
        function clearResults() {
            const responseArea = document.getElementById('responseArea');
            responseArea.classList.add('hidden');
            responseArea.textContent = '';
        }
        
        // åŠ è½½æµ‹è¯•é›†åˆ—è¡¨
        async function loadDatasets() {
            try {
                const response = await fetch('/api/datasets');
                const data = await response.json();
                
                if (response.ok) {
                    currentDatasets = data.datasets;
                    populateDatasetSelect();
                } else {
                    showError('åŠ è½½æµ‹è¯•é›†å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('åŠ è½½æµ‹è¯•é›†å¤±è´¥: ' + error.message);
            }
        }
        
        // å¡«å……æµ‹è¯•é›†é€‰æ‹©æ¡†
        function populateDatasetSelect() {
            const datasetSelect = document.getElementById('datasetSelect');
            datasetSelect.innerHTML = '<option value="">è¯·é€‰æ‹©æµ‹è¯•é›†...</option>';
            
            currentDatasets.forEach(dataset => {
                const option = document.createElement('option');
                option.value = dataset.name;
                option.textContent = `${dataset.display_name} (${dataset.total_samples} æ ·æœ¬)`;
                datasetSelect.appendChild(option);
            });
        }
        
        // åŠ è½½æµ‹è¯•é›†ä¿¡æ¯
        function loadDatasetInfo() {
            const datasetSelect = document.getElementById('datasetSelect');
            const selectedDatasetName = datasetSelect.value;
            const datasetInfo = document.getElementById('datasetInfo');
            
            if (!selectedDatasetName) {
                datasetInfo.classList.add('hidden');
                currentDataset = null;
                return;
            }
            
            currentDataset = currentDatasets.find(d => d.name === selectedDatasetName);
            if (currentDataset) {
                document.getElementById('datasetTitle').textContent = currentDataset.display_name;
                document.getElementById('datasetDescription').textContent = currentDataset.description;
                document.getElementById('datasetSamples').textContent = currentDataset.total_samples;
                document.getElementById('datasetCategories').textContent = currentDataset.categories.length;
                document.getElementById('datasetVersion').textContent = currentDataset.version;
                
                datasetInfo.classList.remove('hidden');
            }
        }
        
        // è¿è¡Œæµ‹è¯•é›†è¯„ä¼°
        async function runDatasetTest() {
            const datasetSelect = document.getElementById('datasetSelect');
            const testModelSelect = document.getElementById('testModelSelect');
            const sampleCountInput = document.getElementById('sampleCountInput');
            const runDatasetBtn = document.getElementById('runDatasetBtn');
            const progressArea = document.getElementById('datasetTestProgress');
            const resultsArea = document.getElementById('datasetTestResults');
            const progressStatus = document.getElementById('progressStatus');
            const progressFill = document.getElementById('progressFill');
            
            const datasetName = datasetSelect.value;
            const modelName = testModelSelect.value;
            const sampleCount = parseInt(sampleCountInput.value);
            
            if (!datasetName) {
                showError('è¯·é€‰æ‹©æµ‹è¯•é›†');
                return;
            }
            
            // æ˜¾ç¤ºè¿›åº¦
            progressArea.classList.remove('hidden');
            resultsArea.classList.add('hidden');
            runDatasetBtn.disabled = true;
            runDatasetBtn.textContent = 'æµ‹è¯•è¿›è¡Œä¸­...';
            progressStatus.textContent = 'å‡†å¤‡æµ‹è¯•...';
            progressFill.style.width = '10%';
            
            try {
                progressStatus.textContent = 'æ­£åœ¨è¿è¡Œæµ‹è¯•é›†è¯„ä¼°...';
                progressFill.style.width = '50%';
                
                const response = await fetch('/api/test/dataset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        dataset: datasetName,
                        model: modelName,
                        sample_count: sampleCount
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    progressStatus.textContent = 'æµ‹è¯•å®Œæˆ';
                    progressFill.style.width = '100%';
                    
                    // æ˜¾ç¤ºç»“æœ
                    displayTestResults([data.report]);
                    resultsArea.classList.remove('hidden');
                    
                    setTimeout(() => {
                        progressArea.classList.add('hidden');
                    }, 2000);
                } else {
                    showError('æµ‹è¯•å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                    progressArea.classList.add('hidden');
                }
            } catch (error) {
                showError('æµ‹è¯•å¤±è´¥: ' + error.message);
                progressArea.classList.add('hidden');
            } finally {
                runDatasetBtn.disabled = false;
                runDatasetBtn.textContent = 'ğŸš€ è¿è¡Œæµ‹è¯•é›†è¯„ä¼°';
            }
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•é›†è¯„ä¼°
        async function runAllDatasetsTest() {
            const testModelSelect = document.getElementById('testModelSelect');
            const sampleCountInput = document.getElementById('sampleCountInput');
            const runAllDatasetsBtn = document.getElementById('runAllDatasetsBtn');
            const progressArea = document.getElementById('datasetTestProgress');
            const resultsArea = document.getElementById('datasetTestResults');
            const progressStatus = document.getElementById('progressStatus');
            const progressFill = document.getElementById('progressFill');
            
            const modelName = testModelSelect.value;
            const sampleCount = parseInt(sampleCountInput.value);
            
            // æ˜¾ç¤ºè¿›åº¦
            progressArea.classList.remove('hidden');
            resultsArea.classList.add('hidden');
            runAllDatasetsBtn.disabled = true;
            runAllDatasetsBtn.textContent = 'æ‰¹é‡æµ‹è¯•ä¸­...';
            progressStatus.textContent = 'å‡†å¤‡æ‰¹é‡æµ‹è¯•...';
            progressFill.style.width = '10%';
            
            try {
                progressStatus.textContent = 'æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•é›†...';
                progressFill.style.width = '50%';
                
                const response = await fetch('/api/test/all-datasets', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: modelName,
                        sample_count: sampleCount
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    progressStatus.textContent = `æ‰¹é‡æµ‹è¯•å®Œæˆ (${data.total_datasets} ä¸ªæµ‹è¯•é›†)`;
                    progressFill.style.width = '100%';
                    
                    // æ˜¾ç¤ºç»“æœ
                    displayTestResults(data.reports);
                    resultsArea.classList.remove('hidden');
                    
                    setTimeout(() => {
                        progressArea.classList.add('hidden');
                    }, 2000);
                } else {
                    showError('æ‰¹é‡æµ‹è¯•å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                    progressArea.classList.add('hidden');
                }
            } catch (error) {
                showError('æ‰¹é‡æµ‹è¯•å¤±è´¥: ' + error.message);
                progressArea.classList.add('hidden');
            } finally {
                runAllDatasetsBtn.disabled = false;
                runAllDatasetsBtn.textContent = 'ğŸ“Š è¿è¡Œæ‰€æœ‰æµ‹è¯•é›†';
            }
        }
        
        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function displayTestResults(reports) {
            const resultsArea = document.getElementById('datasetTestResults');
            
            let html = '<h4>ğŸ“Š æµ‹è¯•ç»“æœ</h4>';
            
            reports.forEach((report, index) => {
                const successRate = (report.success_rate * 100).toFixed(1);
                const scoreAccuracy = (report.avg_score_accuracy * 100).toFixed(1);
                const categoryAccuracy = (report.category_accuracy * 100).toFixed(1);
                
                html += `
                    <div class="result-section">
                        <h5>${report.dataset_name} - ${report.model_name}</h5>
                        <div class="results-grid">
                            <div class="result-card">
                                <h5>æˆåŠŸç‡</h5>
                                <div class="result-value">${successRate}%</div>
                                <div class="result-label">${report.successful_tests}/${report.total_samples} æˆåŠŸ</div>
                            </div>
                            <div class="result-card">
                                <h5>è¯„åˆ†å‡†ç¡®æ€§</h5>
                                <div class="result-value">${scoreAccuracy}%</div>
                                <div class="result-label">è¯„åˆ†åŒ¹é…åº¦</div>
                            </div>
                            <div class="result-card">
                                <h5>ç±»åˆ«å‡†ç¡®æ€§</h5>
                                <div class="result-value">${categoryAccuracy}%</div>
                                <div class="result-label">åˆ†ç±»åŒ¹é…åº¦</div>
                            </div>
                            <div class="result-card">
                                <h5>å¹³å‡å“åº”æ—¶é—´</h5>
                                <div class="result-value">${report.avg_response_time_ms.toFixed(1)}ms</div>
                                <div class="result-label">æ¯ä¸ªæ ·æœ¬</div>
                            </div>
                        </div>
                `;
                
                // æ·»åŠ è¯¦ç»†ç»“æœ
                if (report.detailed_results && report.detailed_results.length > 0) {
                    html += generateDetailedResults(report.detailed_results, `report_${index}`);
                }
                
                html += '</div>';
                
                if (index < reports.length - 1) {
                    html += '<hr style="margin: 1rem 0; border: none; border-top: 1px solid #dee2e6;">';
                }
            });
            
            resultsArea.innerHTML = html;
            
            // ç»‘å®šäº‹ä»¶
            bindDetailedResultsEvents();
        }
        
        // ç”Ÿæˆè¯¦ç»†ç»“æœHTML
        function generateDetailedResults(detailedResults, reportId) {
            let html = `
                <div class="detailed-results">
                    <div class="results-tabs">
                        <button class="tab-button active" data-tab="summary_${reportId}">æ¦‚è§ˆ</button>
                        <button class="tab-button" data-tab="details_${reportId}">è¯¦ç»†å¯¹æ¯”</button>
                        <button class="tab-button" data-tab="errors_${reportId}">é”™è¯¯æ ·æœ¬</button>
                    </div>
                    
                    <div class="tab-content active" id="summary_${reportId}">
                        ${generateSummaryTab(detailedResults)}
                    </div>
                    
                    <div class="tab-content" id="details_${reportId}">
                        ${generateDetailsTab(detailedResults)}
                    </div>
                    
                    <div class="tab-content" id="errors_${reportId}">
                        ${generateErrorsTab(detailedResults)}
                    </div>
                </div>
            `;
            return html;
        }
        
        // ç”Ÿæˆæ¦‚è§ˆæ ‡ç­¾é¡µ
        function generateSummaryTab(results) {
            const correctScores = results.filter(r => r.score_accuracy > 0.8).length;
            const correctCategories = results.filter(r => r.category_match).length;
            const errors = results.filter(r => r.error).length;
            
            let html = `
                <div class="results-grid">
                    <div class="result-card">
                        <h5>è¯„åˆ†æ­£ç¡®</h5>
                        <div class="result-value status-correct">${correctScores}</div>
                        <div class="result-label">å‡†ç¡®ç‡ > 80%</div>
                    </div>
                    <div class="result-card">
                        <h5>ç±»åˆ«æ­£ç¡®</h5>
                        <div class="result-value status-correct">${correctCategories}</div>
                        <div class="result-label">å®Œå…¨åŒ¹é…</div>
                    </div>
                    <div class="result-card">
                        <h5>å¤„ç†é”™è¯¯</h5>
                        <div class="result-value status-incorrect">${errors}</div>
                        <div class="result-label">è§£æå¤±è´¥</div>
                    </div>
                    <div class="result-card">
                        <h5>æ€»æ ·æœ¬æ•°</h5>
                        <div class="result-value">${results.length}</div>
                        <div class="result-label">å·²æµ‹è¯•</div>
                    </div>
                </div>
            `;
            return html;
        }
        
        // ç”Ÿæˆè¯¦ç»†å¯¹æ¯”æ ‡ç­¾é¡µ
        function generateDetailsTab(results) {
            let html = `
                <div class="filters-section">
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>ç­›é€‰çŠ¶æ€:</label>
                            <select class="filter-status">
                                <option value="">å…¨éƒ¨</option>
                                <option value="correct">æ­£ç¡®</option>
                                <option value="incorrect">é”™è¯¯</option>
                                <option value="partial">éƒ¨åˆ†æ­£ç¡®</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>ç±»åˆ«åŒ¹é…:</label>
                            <select class="filter-category">
                                <option value="">å…¨éƒ¨</option>
                                <option value="true">åŒ¹é…</option>
                                <option value="false">ä¸åŒ¹é…</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse text-sm detailed-table">
                        <thead>
                            <tr class="bg-slate-50">
                                <th class="px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200">æ ·æœ¬ID</th>
                                <th class="px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200">è¯„åˆ†å¯¹æ¯”</th>
                                <th class="px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200">ç±»åˆ«å¯¹æ¯”</th>
                                <th class="px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200">æ¨¡å‹å“åº”</th>
                                <th class="px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200">å“åº”æ—¶é—´</th>
                                <th class="px-3 py-3 text-left font-semibold text-slate-700 border-b border-slate-200">çŠ¶æ€</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
            `;
            
            results.forEach(result => {
                const scoreStatus = getScoreStatus(result.score_accuracy);
                const categoryStatus = result.category_match ? 'correct' : 'incorrect';
                
                // ç¡®ä¿æ­£ç¡®æå–æ ·æœ¬ID
                const sampleId = typeof result.sample_id === 'string' ? result.sample_id : 
                                (result.sample_id && result.sample_id.sample_id) || 'Unknown';
                
                html += `
                    <tr class="result-row" data-status="${scoreStatus}" data-category="${result.category_match}">
                        <td><strong class="clickable-sample" onclick="showSampleDetail('${sampleId}', ${JSON.stringify(result).replace(/'/g, '&apos;')})">${sampleId}</strong></td>
                        <td>
                            <div class="score-comparison">
                                <div class="score-expected">æœŸæœ›: ${result.expected_score}</div>
                                <div class="score-actual">å®é™…: ${result.model_score || 'N/A'}</div>
                                ${result.score_diff !== null ? `<div class="score-diff">å·®å€¼: Â±${result.score_diff.toFixed(1)}</div>` : ''}
                            </div>
                        </td>
                        <td>
                            <div class="category-comparison">
                                <div class="category-expected">æœŸæœ›: ${result.expected_category}</div>
                                <div class="category-actual">å®é™…: ${result.model_category || 'N/A'}</div>
                            </div>
                        </td>
                        <td>
                            <div class="response-preview" onclick="expandResponse(this)">
                                ${result.model_response || 'æ— å“åº”'}
                            </div>
                        </td>
                        <td>${result.response_time_ms.toFixed(1)}ms</td>
                        <td>
                            <span class="status-${scoreStatus}">
                                ${scoreStatus === 'correct' ? 'âœ… æ­£ç¡®' : scoreStatus === 'partial' ? 'âš ï¸ éƒ¨åˆ†' : 'âŒ é”™è¯¯'}
                            </span>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            return html;
        }
        
        // ç”Ÿæˆé”™è¯¯æ ‡ç­¾é¡µ
        function generateErrorsTab(results) {
            const errorResults = results.filter(r => r.error || r.score_accuracy < 0.5);
            
            if (errorResults.length === 0) {
                return '<div class="text-center py-8 text-slate-500">ğŸ‰ æ²¡æœ‰æ˜æ˜¾é”™è¯¯çš„æ ·æœ¬ï¼</div>';
            }
            
            let html = `
                <div style="overflow-x: auto;">
                    <table class="detailed-table">
                        <thead>
                            <tr>
                                <th>æ ·æœ¬ID</th>
                                <th>é”™è¯¯ç±»å‹</th>
                                <th>é—®é¢˜æè¿°</th>
                                <th>æ¨¡å‹å“åº”</th>
                                <th>å»ºè®®</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            errorResults.forEach(result => {
                const errorType = result.error ? 'è§£æé”™è¯¯' : 'è¯„åˆ†åå·®';
                const description = result.error || `è¯„åˆ†åå·®è¿‡å¤§ (æœŸæœ›: ${result.expected_score}, å®é™…: ${result.model_score})`;
                const suggestion = result.error ? 'æ£€æŸ¥æ¨¡å‹è¾“å‡ºæ ¼å¼' : 'è°ƒæ•´è¯„åˆ†æ ‡å‡†æˆ–æç¤ºè¯';
                
                // ç¡®ä¿æ­£ç¡®æå–æ ·æœ¬ID
                const sampleId = typeof result.sample_id === 'string' ? result.sample_id : 
                                (result.sample_id && result.sample_id.sample_id) || 'Unknown';
                
                html += `
                    <tr>
                        <td><strong class="clickable-sample" onclick="showSampleDetail('${sampleId}', ${JSON.stringify(result).replace(/'/g, '&apos;')})">${sampleId}</strong></td>
                        <td><span class="status-incorrect">${errorType}</span></td>
                        <td>${description}</td>
                        <td>
                            <div class="response-preview" onclick="expandResponse(this)">
                                ${result.model_response || 'æ— å“åº”'}
                            </div>
                        </td>
                        <td>${suggestion}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            return html;
        }
        
        // è·å–è¯„åˆ†çŠ¶æ€
        function getScoreStatus(accuracy) {
            if (accuracy >= 0.8) return 'correct';
            if (accuracy >= 0.5) return 'partial';
            return 'incorrect';
        }
        
        // ç»‘å®šè¯¦ç»†ç»“æœäº‹ä»¶
        function bindDetailedResultsEvents() {
            // æ ‡ç­¾é¡µåˆ‡æ¢
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    const container = this.closest('.detailed-results');
                    
                    // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
                    container.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active', 'text-indigo-600', 'border-indigo-600');
                        btn.classList.add('text-slate-600', 'border-transparent');
                    });
                    this.classList.add('active', 'text-indigo-600', 'border-indigo-600');
                    this.classList.remove('text-slate-600', 'border-transparent');
                    
                    // åˆ‡æ¢å†…å®¹
                    container.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // ç­›é€‰åŠŸèƒ½
            document.querySelectorAll('.filter-status, .filter-category').forEach(filter => {
                filter.addEventListener('change', function() {
                    const table = this.closest('.tab-content').querySelector('.detailed-table');
                    const rows = table.querySelectorAll('.result-row');
                    const statusFilter = this.closest('.filters-section').querySelector('.filter-status').value;
                    const categoryFilter = this.closest('.filters-section').querySelector('.filter-category').value;
                    
                    rows.forEach(row => {
                        let show = true;
                        
                        if (statusFilter && row.dataset.status !== statusFilter) {
                            show = false;
                        }
                        
                        if (categoryFilter && row.dataset.category !== categoryFilter) {
                            show = false;
                        }
                        
                        row.style.display = show ? '' : 'none';
                    });
                });
            });
        }
        
        // å±•å¼€å“åº”å†…å®¹
        function expandResponse(element) {
            if (element.style.maxHeight === 'none') {
                element.style.maxHeight = '100px';
                element.style.overflow = 'hidden';
            } else {
                element.style.maxHeight = 'none';
                element.style.overflow = 'visible';
            }
        }
        
        // é¢„è§ˆæ ·æœ¬
        async function previewSamples() {
            const datasetSelect = document.getElementById('datasetSelect');
            const samplesPreview = document.getElementById('samplesPreview');
            const samplesContainer = document.getElementById('samplesContainer');
            
            const datasetName = datasetSelect.value;
            if (!datasetName) {
                showError('è¯·å…ˆé€‰æ‹©æµ‹è¯•é›†');
                return;
            }
            
            try {
                const response = await fetch(`/api/datasets/${datasetName}/samples?count=3`);
                const data = await response.json();
                
                if (response.ok) {
                    let html = '';
                    data.samples.forEach(sample => {
                        html += `
                            <div class="bg-white border border-slate-200 rounded-lg p-4 mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <div class="font-semibold text-indigo-600">${sample.id}</div>
                                    <div class="bg-slate-100 px-2 py-1 rounded text-xs">${sample.category}</div>
                                </div>
                                <div class="mb-2 p-3 bg-slate-50 rounded border-l-4 border-indigo-500 font-mono text-sm whitespace-pre-wrap">${sample.content}</div>
                                <div class="flex gap-4 text-xs text-slate-600">
                                    <span>é¢„æœŸè¯„åˆ†: ${sample.expected_score}</span>
                                    <span>å…³é”®è¯: ${sample.keywords.join(', ')}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    samplesContainer.innerHTML = html;
                    samplesPreview.classList.remove('hidden');
                } else {
                    showError('é¢„è§ˆæ ·æœ¬å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('é¢„è§ˆæ ·æœ¬å¤±è´¥: ' + error.message);
            }
        }
        
        // æ˜¾ç¤ºæ ·æœ¬è¯¦æƒ…
        function showSampleDetail(sampleId, resultData) {
            const modal = document.getElementById('sampleModal');
            const modalBody = document.getElementById('sampleModalBody');
            
            // è§£æç»“æœæ•°æ®
            let result;
            try {
                result = typeof resultData === 'string' ? JSON.parse(resultData) : resultData;
            } catch (e) {
                console.error('è§£ææ ·æœ¬æ•°æ®å¤±è´¥:', e);
                return;
            }
            
            // ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„æ ·æœ¬ID
            const actualSampleId = sampleId || result.sample_id || 'Unknown';
            
            // ç”Ÿæˆæ ·æœ¬è¯¦æƒ…HTML
            const html = `
                <div class="grid grid-cols-4 gap-4 mb-6">
                    <div class="bg-slate-50 p-3 rounded">
                        <div class="text-xs font-semibold text-slate-600 mb-1">æ ·æœ¬ID</div>
                        <div class="text-slate-900">${actualSampleId}</div>
                    </div>
                    <div class="bg-slate-50 p-3 rounded">
                        <div class="text-xs font-semibold text-slate-600 mb-1">æœŸæœ›è¯„åˆ†</div>
                        <div class="text-slate-900">${result.expected_score}</div>
                    </div>
                    <div class="bg-slate-50 p-3 rounded">
                        <div class="text-xs font-semibold text-slate-600 mb-1">æ¨¡å‹è¯„åˆ†</div>
                        <div class="text-slate-900">${result.model_score || 'N/A'}</div>
                    </div>
                    <div class="bg-slate-50 p-3 rounded">
                        <div class="text-xs font-semibold text-slate-600 mb-1">è¯„åˆ†å‡†ç¡®æ€§</div>
                        <div class="text-slate-900">${(result.score_accuracy * 100).toFixed(1)}%</div>
                    </div>
                    <div class="bg-slate-50 p-3 rounded">
                        <div class="text-xs font-semibold text-slate-600 mb-1">æœŸæœ›ç±»åˆ«</div>
                        <div class="text-slate-900">${result.expected_category}</div>
                    </div>
                    <div class="bg-slate-50 p-3 rounded">
                        <div class="text-xs font-semibold text-slate-600 mb-1">æ¨¡å‹ç±»åˆ«</div>
                        <div class="text-slate-900">${result.model_category || 'N/A'}</div>
                    </div>
                    <div class="bg-slate-50 p-3 rounded">
                        <div class="text-xs font-semibold text-slate-600 mb-1">ç±»åˆ«åŒ¹é…</div>
                        <div class="text-slate-900">${result.category_match ? 'âœ… åŒ¹é…' : 'âŒ ä¸åŒ¹é…'}</div>
                    </div>
                    <div class="bg-slate-50 p-3 rounded">
                        <div class="text-xs font-semibold text-slate-600 mb-1">å“åº”æ—¶é—´</div>
                        <div class="text-slate-900">${result.response_time_ms}ms</div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h4 class="text-indigo-600 mb-2 font-semibold">ğŸ“ åŸå§‹è¯„è®º</h4>
                    <div class="bg-slate-50 p-4 rounded border-l-4 border-indigo-500 whitespace-pre-wrap font-mono text-sm max-h-48 overflow-y-auto">${result.comment || 'æ— è¯„è®ºå†…å®¹'}</div>
                </div>
                
                <div class="mb-6">
                    <h4 class="text-indigo-600 mb-2 font-semibold">ğŸ¤– æ¨¡å‹å“åº”</h4>
                    <div class="bg-slate-50 p-4 rounded border-l-4 border-indigo-500 whitespace-pre-wrap font-mono text-sm max-h-48 overflow-y-auto">${result.model_response || 'æ— å“åº”å†…å®¹'}</div>
                </div>
                
                ${result.error ? `
                <div class="mb-6">
                    <h4 class="text-red-600 mb-2 font-semibold">âŒ é”™è¯¯ä¿¡æ¯</h4>
                    <div class="bg-red-50 p-4 rounded border-l-4 border-red-500 whitespace-pre-wrap font-mono text-sm">${result.error}</div>
                </div>
                ` : ''}
            `;
            
            modalBody.innerHTML = html;
            modal.classList.add('show');
        }
        
        // å…³é—­æ ·æœ¬è¯¦æƒ…æ¨¡æ€æ¡†
        function closeSampleModal() {
            const modal = document.getElementById('sampleModal');
            modal.classList.remove('show');
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        document.getElementById('sampleModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSampleModal();
            }
        });
        
        // ESCé”®å…³é—­æ¨¡æ€æ¡†
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeSampleModal();
            }
        });
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', function() {
            stopAutoRefresh();
        });
    </script>
    
    <!-- æ ·æœ¬è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="sampleModal" class="modal fixed inset-0 z-50 bg-black bg-opacity-50 items-center justify-center">
        <div class="bg-white m-8 p-8 rounded-lg w-full max-w-4xl max-h-[80vh] overflow-y-auto relative">
            <div class="flex justify-between items-center mb-6 pb-4 border-b border-slate-200">
                <h3 class="text-xl font-semibold text-slate-800">æ ·æœ¬è¯¦æƒ…</h3>
                <button class="w-8 h-8 flex items-center justify-center text-slate-400 hover:text-slate-600 text-2xl font-light" onclick="closeSampleModal()">&times;</button>
            </div>
            <div id="sampleModalBody">
                <!-- æ ·æœ¬è¯¦æƒ…å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>
</body>
</html>
