# Markdown提示词配置系统

## 🎯 核心优势

相比复杂的YAML配置，MD自然语言配置具有以下优势：

| 特性 | YAML配置 | MD配置 | 优势 |
|------|----------|--------|------|
| **学习成本** | 需要了解YAML语法 | 只需会写Markdown | ⭐⭐⭐⭐⭐ |
| **编辑难度** | 嵌套结构复杂 | 自然语言描述 | ⭐⭐⭐⭐⭐ |
| **可读性** | 技术文档风格 | 文档化描述 | ⭐⭐⭐⭐⭐ |
| **维护性** | 字段繁多易错 | 结构清晰直观 | ⭐⭐⭐⭐ |
| **扩展性** | 需要了解架构 | 直接添加章节 | ⭐⭐⭐⭐ |

## 📝 配置格式对比

### YAML格式（复杂）
```yaml
dataset_name: "manga_comment_ad_detection_simple"
display_name: "漫画评论广告检测(小模型版)"
version: "1.0"
prompt_template: |
  请分析以下漫画评论...
variables:
  content: "{{sample_content}}"
quality_checks:
  - name: "格式检查"  
    pattern: '评分：\s*[0-5]'
    error_message: "格式错误"
```

### MD格式（简单）
```markdown
# 漫画评论广告检测

## 配置信息
- 数据集ID：manga_comment_ad_detection_simple
- 版本：1.0
- 适用模型：小模型版

## 提示词模板
分析这条漫画评论是否为广告：
评论：{content}
请按以下格式回答：...

## 质量检查规则
1. 必须包含"评分："、"类别："、"理由："三个部分
2. 评分必须是0-5之间的整数
```

## 🚀 使用方法

### 1. 创建新的MD配置文件

在 `prompts/md_prompts/` 目录下创建 `.md` 文件：

```markdown
# 你的数据集名称

## 配置信息
- 数据集ID：your_dataset_id
- 版本：1.0
- 适用模型：小模型版

## 任务描述
简单描述这个数据集要做什么

## 类别定义
- **类别1**：描述
- **类别2**：描述

## 提示词模板
你的提示词内容，使用 {content} 等变量

## 示例输出
```
期望的输出格式示例
```

## 质量检查规则
1. 规则1
2. 规则2
```

### 2. 变量使用

MD配置支持以下标准变量：
- `{content}` - 样本内容
- `{expected_category}` - 预期类别
- `{expected_score}` - 预期评分

### 3. 系统集成

系统会自动优先使用MD配置：
```python
# 自动使用MD管理器，YAML作为备选
prompt = md_manager.render_prompt(dataset_name, sample_data)
```

## 📂 文件结构

```
prompts/
├── md_prompts/              # MD配置文件目录
│   ├── 漫画评论广告检测.md
│   ├── 通话语义投诉分类.md
│   └── 通用内容分析.md
├── md_manager.py            # MD管理器
├── test_md_system.py        # 测试脚本
└── MD_PROMPT_GUIDE.md       # 本文档
```

## 🎨 标准模板

### 基础模板
```markdown
# 数据集标题

## 配置信息
- 数据集ID：dataset_id
- 版本：1.0
- 适用模型：小模型版/通用版
- 输出格式：简化格式/JSON格式

## 任务描述
一句话描述任务

## 类别定义
- **类别A**：描述A
- **类别B**：描述B

## 评分说明
- **1分**：说明
- **2分**：说明

## 提示词模板
实际的提示词内容...

## 示例输出
### 示例1
```
期望输出1
```

### 示例2  
```
期望输出2
```

## 质量检查规则
1. 检查规则1
2. 检查规则2

## 关键词参考
- **类型A**：关键词1、关键词2
- **类型B**：关键词3、关键词4
```

## ⚡ 实际测试结果

运行测试脚本的结果显示：

```bash
=== 测试MD提示词管理系统 ===

1. 可用数据集:
   - 漫画评论广告检测 (manga_comment_ad_detection_simple)
   - 通话语义投诉分类 (call_semantic_complaints_simple)  
   - 通用内容分析 (general_simple)

2. 提示词渲染: ✅ 成功
3. 响应解析: ✅ 支持简化格式和JSON格式
4. 质量检查: ✅ 自动验证格式规则
5. 错误处理: ✅ 自动备用机制
```

## 🔧 高级功能

### 1. 多格式解析支持
```python
# 自动识别格式
parsed = manager.parse_response(dataset_name, response)

# 支持的格式：
# - JSON: {"field": "value"}
# - 简化: 字段：值
# - 混合格式
```

### 2. 智能质量检查
```python
errors = manager.validate_response(dataset_name, response)
# 自动检查：
# - 必要字段完整性
# - 数值范围验证  
# - 格式规范性
```

### 3. 容错机制
- MD解析失败 → 自动使用YAML配置
- YAML解析失败 → 使用硬编码备用
- 多层备选确保系统稳定性

## 🏃‍♂️ 快速开始

1. **复制模板**：从现有MD文件复制格式
2. **修改内容**：替换为你的任务描述和规则  
3. **测试验证**：运行测试脚本确认正常
4. **投入使用**：系统自动识别新配置

## 💡 最佳实践

1. **命名规范**：使用中文名称，便于理解
2. **结构清晰**：严格按照标准章节组织
3. **示例丰富**：提供多种输出示例
4. **规则明确**：质量检查规则要具体可执行
5. **关键词全面**：有助于人工审核和调试

## 🔄 迁移步骤

从YAML配置迁移到MD配置：

1. **创建MD文件**：按照模板创建对应的.md文件
2. **提取内容**：将YAML中的提示词和规则转换为自然语言
3. **测试验证**：确保功能正常
4. **逐步替换**：可以保留YAML作为备选

---

**总结**：MD配置大幅降低了提示词管理的复杂度，让非技术人员也能轻松编辑和维护提示词，是更适合团队协作的解决方案！